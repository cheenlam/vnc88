<div class="contBox-min broadcast">
    <!-- liveBox start -->
    <div class="liveBox">
        <div class="liveTitle">
            <div>
                <img src="images/icon/hot.gif">
                <span>Truyền hình trực tiếp</span>
            </div>
        </div>
        <div class="liveList" id="liveList">
            <ul></ul>
        </div>
        <div class="liveBtn">
            <div class="btn_linear_c2 btn">
                <div class="btn_cnt">Xem tất cả</div>
            </div>
        </div>
    </div>

    <div class="videoBanner">
        <img src="images/videoBanner-01.jpg">
    </div>

    <div class="mainMsg">
        <div class="mainMsg-title">VIDEO</div>
        <!-- videoBox start -->
        <div class="videoBox">
            <div class="gameShow" id="gameShow">
                <div class="main">
                    <iframe src="" frameborder="0" id="showMv"></iframe>
                </div>
                <div class="list">
                    <div class="arrow_l"></div>
                    <div class="arrow_r"></div>
                    <div class="listArray" id="listArray">
                        <ul></ul>
                    </div>
                </div>
            </div>
            <div class="gameMsg" id="gameMsg">
                <div class="mainMsg-title">BẢNG XẾP HẠNG</div>
                <div class="gameChart">
                    <select>
                        <option value="1">Chọn giải đấu</option>
                        <option value="2">Cúp C1</option>
                    </select>
                    <div class="gameChart_tb" id="gameChart_tb">
                        <table>
                            <tr>
                                <th>TT</th>
                                <th>Đội</th>
                                <th>Trận</th>
                                <th>HS</th>
                                <th>Điểm</th>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="mainMsg-title">Kết quả</div>

                <div class="gameSchedule">
                    <div class="gameSchedule_tb" id="gameSchedule_tb">
                        <table></table>
                    </div>
                </div>
            </div>
        </div>

        <!-- chatBox start (聊天室) -->
        <div class="chatBox">
            <div class="chatroom">
                <div class="chat_title">聊天室</div>
                <div class="chat_list" id="chat_list">
                    <div id="chat_sc">
                        <ul></ul>
                    </div>
                </div>
                <div class="chat_ipt" id="chat_ipt">
                    <div class="chat_txt">
                        <div class="chat_msg" id="chat_msg" contenteditable="true"></div>
                        <span class="chat_take" disabled>Message</span>
                    </div>
                    <div class="chat_iconBtn" id="chat_iconBtn">
                        <div class="chat_iconList" id="chat_iconList">
                            <ul>
                                <li><img src="images/icon/i_chat_1.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_2.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_3.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_4.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_5.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_6.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_7.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_8.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_9.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_10.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_11.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_12.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_13.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_14.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_15.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_16.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_17.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_18.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_19.png" class="chat_icon"></li>
                                <li><img src="images/icon/i_chat_20.png" class="chat_icon"></li>
                            </ul>
                        </div>
                    </div>

                    <input type="color" class="chat_color" id="chat_color"></input>
                </div>
            </div>

            <div class="chatAd">
                <ul>
                    <li>
                        <img src="images/chatAd_01.png">
                    </li>
                    <li>
                        <img src="images/chatAd_02.png">
                    </li>
                    <li>
                        <img src="images/chatAd_03.png">
                    </li>
                    <li>
                        <img src="images/chatAd_04.png">
                    </li>
                </ul>
            </div>
        </div>

        <!-- scheduleList start (時程表) -->
        <div class="scheduleList" id="scheduleList">
            <div class="mainMsg-title">LỊCH THI ĐẤU</div>
            <!-- dateList -->
            <div class="dateList">
                <div class="today">14/07/2021</div>
                <ul></ul>
            </div>
            <!-- matchList -->
            <div class="matchList">
                <table></table>
            </div>
        </div>
    </div>
</div>




<script>
    var arrayNum = 0;
    var movieArray = []
    $('#gameShow .arrow_l').click(function() {
        arrayNum == 0 ? 0 : arrayNum--;
        $('#listArray ul').css('transform', `translateX(-${arrayNum*23}%)`)
    })

    $('#gameShow .arrow_r').click(function() {
        arrayNum == 3 ? 3 : arrayNum++;
        $('#listArray ul').css('transform', `translateX(-${arrayNum*23}%)`)
    })


    docRef.get().then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
            let data = doc.data();
            let liData = `<li>
                            <div>
                                <div class="liveList_mv">
                                    <iframe src="https://www.youtube.com/embed/${data.videoId}" frameborder="0"></iframe>
                                </div>
                                <div class="liveList_msg">${data.title}</div>
                            </div>
                        </li>`
            $('#liveList ul').append(liData);
        });

        getMovie()
    })

    function getMovie() {
        docRef2.get().then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
                let data = doc.data();
                let liData = `<li videoId="${data.videoId}" onclick="chMovie(this)">
                            <div>
                                <div class="listArray_img">
                                    <img src="${data.imgUrl}">
                                </div>
                                <div class="listArray_msg">
                                    <span>${data.time}</span>
                                    <p>${data.title}</p>     
                                </div>
                            </div>
                        </li>`

                $('#listArray ul').append(liData);
                movieArray.push(data.videoId);
                $('#gameShow iframe').attr('src', `https://www.youtube.com/embed/${movieArray[0]}`)
            });
        })
    }

    function chMovie(e) {
        let getId = $(e).attr('videoid')
        $('#gameShow iframe').attr('src', `https://www.youtube.com/embed/${getId}`)
    }

    // 靜態假資料
    var chartData = [{
        sort: 'Bảng A',
        list: [{
            flagUrl: 'images/flag/italy.png',
            name: 'Italy',
            num: [3, 7, 9]
        }, {
            flagUrl: 'images/flag/wales.png',
            name: 'Wales',
            num: [3, 1, 4]
        }, {
            flagUrl: 'images/flag/switzerland.png',
            name: 'Switzerland',
            num: [3, -1, 4]
        }, {
            flagUrl: 'images/flag/turkey.png',
            name: 'Turkey',
            num: [3, -7, 0]
        }]
    }, {
        sort: 'Bảng B',
        list: [{
            flagUrl: 'images/flag/belgium.png',
            name: 'Belgium',
            num: [3, 6, 9]
        }, {
            flagUrl: 'images/flag/denmark.png',
            name: 'Denmark',
            num: [3, 1, 3]
        }, {
            flagUrl: 'images/flag/finland.png',
            name: 'Finland',
            num: [3, -2, 3]
        }, {
            flagUrl: 'images/flag/russia.png',
            name: 'Russia',
            num: [3, -5, 3]
        }]
    }, ];
    var scheduleData = [{
        sort: 'Premier League 24/07/2021',
        list: [{
            club_1_name: 'CSKA Moscow',
            club_1_badge: 'images/badge/cska-moscow.png',
            club_2_name: 'Ufa',
            club_2_badge: 'images/badge/ufa.png',
            saibe: 'CONCACAF Gold Cup',
            time: '19:30',
            day: '24/07/2021',
            live: true,
        }, {
            club_1_name: 'FK Krylya Sovetov Samara',
            club_1_badge: 'images/badge/FK-Krylya-Sovetov-Samara.png',
            club_2_name: 'Akhmat Grozny',
            club_2_badge: 'images/badge/akhmat-grozny.png',
            saibe: 'Liga Mexico',
            time: '20:00',
            day: '24/07/2021',
            live: true,
        }, {
            club_1_name: 'FK Rostov',
            club_1_badge: 'images/badge/fk-rostov.png',
            club_2_name: 'Dynamo Moscow',
            club_2_badge: 'images/badge/dynamo-moscow.png',
            saibe: 'Giao Hữu CLB',
            time: '20:00',
            day: '24/07/2021',
            live: false,
        }, {
            club_1_name: 'Khimki',
            club_1_badge: 'images/badge/khimk.png',
            club_2_name: 'Zenit',
            club_2_badge: 'images/badge/zenit.png',
            saibe: 'Ngoại Hạng Banglades',
            time: '22:00',
            day: '24/07/2021',
            live: false,
        }, ]
    }]

    // 影片區側邊比賽訊息
    function dataEach_1() {
        chartData.forEach(function(data) {
            let combination = ''
            combination += `<tr>
                            <td colspan="5" class="sort">${data.sort}</td>
                        </tr>`
            let getData = data;
            for (let i = 0; i < getData.list.length; i++) {
                let data = getData.list[i];

                combination += `<tr>
                                <td>${i+1}</td>
                                <td>
                                    <div class="flag">
                                        <img src="${data.flagUrl}">
                                    </div>
                                    <span>${data.name}</span>
                                </td>
                                <td>${data.num[0]}</td>
                                <td>${data.num[1]}</td>
                                <td>${data.num[2]}</td>
                            </tr>`
            }

            $('#gameChart_tb table').append(combination);
        })
    }

    function dataEach_2() {
        scheduleData.forEach(function(data) {
            let combination = ''
            combination += `<tr>
                            <th colspan="3">${data.sort}</th>
                        </tr>`
            let getData = data;
            for (let i = 0; i < getData.list.length; i++) {
                let data = getData.list[i];
                combination += ` <tr>
                                <td>
                                    <div class="club_1">
                                        <span>${data.club_1_name}</span>
                                        <div class="badge">
                                            <img src="${data.club_1_badge}">
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="time">${data.time}</span>
                                </td>
                                <td>
                                    <div class="club_2">
                                        <div class="badge">
                                            <img src="${data.club_2_badge}">
                                        </div>
                                        <span>${data.club_2_name}</span>
                                    </div>
                                </td>
                            </tr>`
            }
            $('#gameSchedule_tb table').append(combination);
        })

    }

    for (let i = 0; i < 5; i++) {
        dataEach_1()
        dataEach_2()
        dataEach_3()
    }

    // 日程表今日日期
    var scheduleToday = new Date();

    function formatDate(date) {
        let formatted_date = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear()
        return formatted_date;
    }
    $('#scheduleList .dateList .today').html(formatDate(scheduleToday));

    // 日程表清單日期(抓今日時間更新); 
    var scheduleWeek = []
    var scheduleNum = []
    var weekTxt = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
    scheduleWeek[3] = weekTxt[new Date().getDay()];
    scheduleNum[3] = new Date().getDate();

    for (let i = 1; i < 4; i++) {
        let week = [];
        for (let k = 0; k < 4; k++) {
            week[k] = new Date()
        };
        let getWeek_cut = weekTxt[new Date(week[0].setDate(week[0].getDate() - i)).getDay()];
        let getWeek_plus = weekTxt[new Date(week[1].setDate(week[1].getDate() + i)).getDay()];
        let getNum_cut = new Date(week[2].setDate(week[2].getDate() - i)).getDate();
        let getNum_plus = new Date(week[3].setDate(week[3].getDate() + i)).getDate();
        scheduleWeek[3 - i] = getWeek_cut;
        scheduleWeek[3 + i] = getWeek_plus;
        scheduleNum[3 - i] = getNum_cut;
        scheduleNum[3 + i] = getNum_plus;
    }

    for (let i = 0; i < scheduleWeek.length; i++) {
        let dateList = `<li>
                       <div class="date_num">${scheduleNum[i]}</div>
                       <div class="date_week">${scheduleWeek[i]}</div>
                    </li>`
        $('#scheduleList .dateList ul').append(dateList);
    }

    function dataEach_3() {
        scheduleData.forEach(function(data) {
            let combination = ''
            let getData = data;
            for (let i = 0; i < getData.list.length; i++) {
                let data = getData.list[i];

                combination += ` <tr>
                                    <td>
                                        <div class="match_title ${data.live == true?'on':''}">
                                            <div class="match_time">
                                                <p>${data.time} - ${data.day}</p>
                                                <div class="match_live">live</div>
                                            </div>
                                            <p>${data.saibe}</p>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="match_teams">
                                            <div class="team team_L">
                                                <span>${data.club_1_name}</span>
                                                <div class="team_flag">
                                                    <img src="${data.club_1_badge}">
                                                </div>                            
                                            </div>
                                            <div class="vs">VS</div>
                                            <div class="team team_R">
                                                <div class="team_flag">
                                                    <img src="${data.club_2_badge}">
                                                </div>
                                                <span>${data.club_2_name}</span>
                                            </div>
                                        </div>
                                    </td>
                                </tr>`
            }

            $('#scheduleList .matchList table').append(combination);
        })
    }


    // 聊天室
    var databaseMs = new Date().getTime()
    database.on('value', function(snapshot) {
        var getData = snapshot.val()
        var txt = ''
        for (let i in getData) {
            let msg = getData[i].msg.split('<div>').join('').split('</div>').join('').replace('<br>', '');

            txt += `<li class="${getData[i].id == 'id' + databaseMs?'self':''}" >
                        <div class="chat_member">
                            <span class="chat_time" id="chat_time">${getData[i].time}</span>
                            <span class="chat_name" id="chat_name">${getData[i].name}</span>
                        </div>
                        <div class="chat_speak" id="chat_speak" style="color:${getData[i].color}">${msg}</div>
                    </li>`
        }

        $('#chat_list ul').html(txt)

        var chat_sc = document.getElementById('chat_sc');
        chat_sc.scrollTop = chat_sc.scrollHeight;
    });

    var chat_ipt = false
    $('#chat_msg').focus(function() {
        chat_ipt = true
    }).blur(function() {
        chat_ipt = false
    })

    $(document).keydown(function(e) {
        if (e.keyCode == 13 && chat_ipt) {
            write();
        }
    });

    // 加入icon圖片
    $('#chat_iconList li').click(function() {
        let getIndex = $('#chat_iconList li').index(this);
        $('#chat_msg').append(`<img src="images/icon/i_chat_${getIndex+1}.png" class="chat_icon">`);
        $('#chat_msg').focus();
        showTake();
    })

    $('#chat_msg').focus(function() {
        $(document).keydown(function(e) {
            showTake();

        });
    })

    function showTake() {
        let state = $('#chat_msg').html().length;
        if (state >= 1) {
            $('.chat_take').css('display', 'none');
        } else {
            $('.chat_take').css('display', 'flex');
        }
    }



    function write() {
        var date = new Date();
        var h = date.getHours();
        var m = date.getMinutes();
        var s = date.getSeconds();
        if (h < 10) {
            h = '0' + h;
        }
        if (m < 10) {
            m = '0' + m;
        }
        var now = h + ':' + m
        var getMsg = $('#chat_msg').html().split('<div>').join('').split('</div>').join('').replace('<br>', '')
        var postData = {
            name: '匿名',
            msg: getMsg,
            time: now,
            id: 'id' + databaseMs,
            color: $('#chat_color').val()
        };

        firebase.database().ref().push(postData);
        $('#chat_msg').attr('contenteditable', "false")
        $('#chat_msg').html('')
        $('#chat_msg').attr('contenteditable', "true");
        setTimeout(function() {
            $('#chat_msg').focus();
        }, 100)
    }
</script>

<script src="js/index.js"></script>